<style>
    :root {
        --bg-color: #ffffff;
        --text-color: #000000;
        --border-color: #cccccc;
        --button-bg: #f0f0f0;
        --button-hover-bg: #e0e0e0;
        --table-header-bg: #f9f9f9;
        --table-border: #ddd;
    }

    body.dark-mode {
        --bg-color: #1e1e1e;
        --text-color: #e0e0e0;
        --border-color: #444444;
        --button-bg: #333333;
        --button-hover-bg: #444444;
        --table-header-bg: #2a2a2a;
        --table-border: #444444;
    }

    body {
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
        font-family: Arial, sans-serif;
        /* Brand is now part of the page flow, so use normal padding */
        padding: 16px;
    }

    #theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 15px;
        background-color: var(--button-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        z-index: 1000;
        transition: background-color 0.3s;
    }

    #theme-toggle:hover {
        background-color: var(--button-hover-bg);
    }

    h1 {
        color: var(--text-color);
    }

    form {
        background-color: var(--button-bg);
        padding: 12px;
        border-radius: 5px;
        margin: 20px 0;
        border: 1px solid var(--border-color);
    }

    input, select, textarea {
        background-color: var(--bg-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 5px;
        border-radius: 3px;
    }

    button {
        background-color: var(--button-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 6px 10px;
        border-radius: 3px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    button:hover {
        background-color: var(--button-hover-bg);
    }

    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        border: 1px solid var(--table-border);
    }

    table thead {
        background-color: var(--table-header-bg);
    }

    table th, table td {
        border: 1px solid var(--table-border);
        padding: 5px;
        text-align: left;
    }

    table tbody tr:hover {
        background-color: var(--button-bg);
    }

    /* Info icon tooltip styles */
    .info-icon {
        display: inline-block;
        margin-left: 8px;
        width: 16px;
        height: 16px;
        line-height: 16px;
        text-align: center;
        border-radius: 50%;
        background: var(--table-header-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        font-size: 12px;
        font-weight: 700;
        cursor: default;
        position: relative;
    }

    .info-icon:focus, .info-icon:hover {
        background: var(--button-bg);
        outline: none;
    }

    /* Tooltip element (DOM) replaces the ::after approach for better accessibility and JS control */
    .info-icon .tooltip {
        position: absolute;
        left: 50%;
        transform: translateX(-50%) translateY(6px) scale(0.98);
        bottom: calc(100% + 8px);
        min-width: 200px;
        max-width: 320px;
        background: var(--button-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 8px 10px;
        border-radius: 6px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        white-space: normal;
        display: block; /* kept in flow but hidden via opacity/visibility */
        z-index: 1000;
        font-size: 12px;
        text-align: left;
        opacity: 0;
        visibility: hidden;
        transition: opacity 160ms ease, transform 160ms ease, visibility 160ms;
        transform-origin: 50% 100%;
        pointer-events: none;
    }

    .info-icon:hover .tooltip,
    .info-icon:focus .tooltip,
    .info-icon.open .tooltip {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0) scale(1);
        pointer-events: auto;
    }

    .info-icon .icon {
        width: 14px;
        height: 14px;
        display: inline-block;
        vertical-align: middle;
    }

    /* Site brand (top-left) */
    #site-brand {
        /* Keep the brand in the normal document flow (not fixed) */
        position: static;
        display: inline-block;
        z-index: 10;
        font-size: 32px;
        font-weight: 900;
        color: var(--text-color);
        text-decoration: none;
        background: transparent;
        padding: 4px 6px;
        margin-bottom: 8px;
    }

    /* Slightly smaller on narrow screens */
    @media (max-width: 480px) {
        #site-brand { font-size: 20px; left: 12px; top: 8px; }
        #theme-toggle { top: 8px; right: 12px; }
    }


    #pagination {
        margin-top: 20px;
        text-align: center;
    }
</style>

<!-- Dark Mode Toggle Button -->
<a id="site-brand" href="/" aria-label="Homepage">HotelStack.net</a>
<button id="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>

<!-- SVG sprite for icons (hidden) -->
<svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" focusable="false">
    <symbol id="icon-question" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1" fill="none"/>
        <path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        <path d="M12 17h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </symbol>
</svg>

<h2>Tell us about the hotel you are planning a stay at</h2>

<form method="post" id="calc-form">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Calculate</button>
</form>

<script>
// Dark Mode Toggle Function
function toggleTheme() {
    const html = document.documentElement;
    const body = document.body;
    const isDarkMode = body.classList.toggle('dark-mode');
    const themeToggle = document.getElementById('theme-toggle');
    
    // Update button text and icon
    themeToggle.textContent = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    
    // Save preference to localStorage
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
}

// Load saved theme preference on page load
document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const isDarkMode = savedTheme === 'dark' || (savedTheme === null && prefersDark);
    
    if (isDarkMode) {
        document.body.classList.add('dark-mode');
        document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è Light Mode';
    }
});

document.addEventListener('DOMContentLoaded', function() {
    const corpSelect = document.querySelector('#id_corporation');
    if (!corpSelect) return;

    corpSelect.addEventListener('change', function() {
        // Send the selected corporation name (the visible text) so
        // the server can return brands for that corporation.
        const selectedText = corpSelect.options[corpSelect.selectedIndex].text;
        const params = new URLSearchParams({ corporation: selectedText });
        const url = window.location.origin + '{% url "ajax_brand_field" %}' + '?' + params.toString();

        fetch(url, { method: 'GET', headers: { 'X-Requested-With': 'XMLHttpRequest' } })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.text();
            })
            .then(html => {
                const parser = new DOMParser();
                const htmlDocument = parser.parseFromString(html, "text/html");
                
                // Replace brand field markup with returned HTML fragment
                const container = document.querySelector('#id_brand');
                if (container) container.outerHTML = htmlDocument.documentElement.querySelector('#id_brand').outerHTML;

                const eliteContainer = document.querySelector('#id_elite_status');
                if (eliteContainer) eliteContainer.outerHTML = htmlDocument.documentElement.querySelector('#id_elite_status').outerHTML;
            })
            .catch(err => console.error('Error fetching brand field:', err));
    });
});
</script>

<table id="price-table">
    <thead>
        <tr>
            <th>Booking Channel
                <span class="info-icon" tabindex="0" role="button" aria-label="Booking Channel info" aria-expanded="false">
                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-question"></use></svg>
                    <span class="tooltip" role="tooltip">Where the room is booked (hotel direct, online travel agency, metasearch, etc.).</span>
                </span>
            </th>
            <th>Total Cash Price For All Nights
                <span class="info-icon" tabindex="0" role="button" aria-label="Total cash price info" aria-expanded="false">
                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-question"></use></svg>
                    <span class="tooltip" role="tooltip">Total cash price for the entire stay before rebates, cashback, or portal rewards.</span>
                </span>
            </th>
            <th>Hotel Points Earned
                <span class="info-icon" tabindex="0" role="button" aria-label="Hotel points info" aria-expanded="false">
                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-question"></use></svg>
                    <span class="tooltip" role="tooltip">Loyalty program points awarded by the hotel for this stay (may vary by rate and elite status).</span>
                </span>
            </th>
            <th>Credit Card Points Earned
                <span class="info-icon" tabindex="0" role="button" aria-label="Credit card points info" aria-expanded="false">
                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-question"></use></svg>
                    <span class="tooltip" role="tooltip">Points or miles earned from the credit card used for the booking (per-card earn rates may apply).</span>
                </span>
            </th>
            <th>Shopping Portal Rewards Earned
                <span class="info-icon" tabindex="0" role="button" aria-label="Shopping portal rewards info" aria-expanded="false">
                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-question"></use></svg>
                    <span class="tooltip" role="tooltip">Cashback or points earned via shopping portals or affiliate portals when booking through that channel.</span>
                </span>
            </th>
            <th>Net Cost After Rebate
                <span class="info-icon" tabindex="0" role="button" aria-label="Net cost info" aria-expanded="false">
                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-question"></use></svg>
                    <span class="tooltip" role="tooltip">Final cash cost after subtracting cashback, portal rebates, or other discounts. Points are shown separately and not subtracted here.</span>
                </span>
            </th>
        </tr>
    </thead>
    <tbody>
        {% for price_option in price_options %}
        {% include "price_card.html" with price_option=price_option %}
        {% endfor %}
    </tbody>
</table>

<!-- Pagination Controls -->
<div id="pagination" style="margin-top: 20px; text-align: center;">
    <button id="prev-btn" onclick="prevPage()" style="padding: 8px 12px; margin: 0 5px;">‚Üê Previous</button>
    <span id="page-info" style="margin: 0 15px;">Page 1</span>
    <button id="next-btn" onclick="nextPage()" style="padding: 8px 12px; margin: 0 5px;">Next ‚Üí</button>
</div>

<script>
const ROWS_PER_PAGE = 15;  // Change this to show more/fewer rows per page
let currentPage = 1;
let totalPages = 1;

document.addEventListener('DOMContentLoaded', function() {
    initPagination();
});

function initPagination() {
    const tableBody = document.querySelector('#price-table tbody');
    const rows = tableBody.querySelectorAll('tr');
    totalPages = Math.ceil(rows.length / ROWS_PER_PAGE);
    
    if (totalPages <= 1) {
        // Hide pagination if only one page
        document.querySelector('#pagination').style.display = 'none';
        return;
    }
    
    showPage(1);
}

function showPage(pageNum) {
    const tableBody = document.querySelector('#price-table tbody');
    const rows = tableBody.querySelectorAll('tr');
    
    // Hide all rows
    rows.forEach(row => row.style.display = 'none');
    
    // Show rows for current page
    const startIdx = (pageNum - 1) * ROWS_PER_PAGE;
    const endIdx = startIdx + ROWS_PER_PAGE;
    
    for (let i = startIdx; i < endIdx && i < rows.length; i++) {
        rows[i].style.display = '';
    }
    
    currentPage = pageNum;
    
    // Update page info
    document.querySelector('#page-info').textContent = `Page ${currentPage} of ${totalPages}`;
    
    // Update button states
    document.querySelector('#prev-btn').disabled = currentPage === 1;
    document.querySelector('#next-btn').disabled = currentPage === totalPages;
}

function nextPage() {
    if (currentPage < totalPages) {
        showPage(currentPage + 1);
    }
}

function prevPage() {
    if (currentPage > 1) {
        showPage(currentPage - 1);
    }
}
</script>

<!-- Tooltip touch/click handling: keep tooltip open on tap, close on outside click; support keyboard toggling -->
<script>
document.addEventListener('click', function (ev) {
    // If click is inside an info-icon, toggle it. Otherwise close all open tooltips.
    const icon = ev.target.closest && ev.target.closest('.info-icon');
    if (icon) {
        // Toggle open state
        const isOpen = icon.classList.contains('open');
        // Close others
        document.querySelectorAll('.info-icon.open').forEach(i => {
            if (i !== icon) {
                i.classList.remove('open');
                i.setAttribute('aria-expanded', 'false');
            }
        });
        if (isOpen) {
            icon.classList.remove('open');
            icon.setAttribute('aria-expanded', 'false');
        } else {
            icon.classList.add('open');
            icon.setAttribute('aria-expanded', 'true');
        }
        // Prevent click from closing immediately
        ev.stopPropagation();
        return;
    }

    // Click elsewhere ‚Äî close all
    document.querySelectorAll('.info-icon.open').forEach(i => {
        i.classList.remove('open');
        i.setAttribute('aria-expanded', 'false');
    });
});

// Close tooltips on Escape
document.addEventListener('keydown', function (ev) {
    if (ev.key === 'Escape' || ev.key === 'Esc') {
        document.querySelectorAll('.info-icon.open').forEach(i => {
            i.classList.remove('open');
            i.setAttribute('aria-expanded', 'false');
            i.blur();
        });
    }
});

// Keyboard toggle for Enter/Space on focused info icon
document.addEventListener('keydown', function (ev) {
    const active = document.activeElement;
    if (!active || !active.classList) return;
    if (!active.classList.contains('info-icon')) return;
    if (ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        active.click();
    }
});
</script>